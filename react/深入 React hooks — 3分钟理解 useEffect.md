## å‰è¨€
React Hooksçš„åŸºæœ¬ç”¨æ³•ï¼Œ[å®˜æ–¹æ–‡æ¡£](https://react.docschina.org/docs/hooks-intro.html) å·²ç»éå¸¸è¯¦ç»†ã€‚æœ¬æ–‡çš„ç›®çš„ï¼Œæ˜¯æƒ³é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­è¯¦ç»†åˆ†æä¸€äº›ä»¤äººç–‘æƒ‘çš„é—®é¢˜åŠå…¶èƒŒåçš„åŸå› ã€‚è¿™æ˜¯ç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œä¸»è¦è®²è§£ useEffectã€‚

**ä¸ªäººåšå®¢åœ°å€ [ğŸ¹ğŸ° fe-code](https://github.com/wuyawei/fe-code)**

## ä¾èµ–
> é€šè¿‡ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†ä¸€äº›å¾ˆé‡è¦çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šæ¯æ¬¡æ›´æ–°éƒ½æ˜¯ä¸€æ¬¡é‡æ–°æ‰§è¡Œã€‚è¿™ä¸ä»…ä»…æ˜¯å¯¹äº useState æ¥è¯´çš„ï¼Œæ•´ä¸ªå‡½æ•°ç»„ä»¶éƒ½æ˜¯è¿™æ ·ã€‚ä¸å¤ªäº†è§£çš„åŒå­¦ï¼Œå¯ä»¥å…ˆé˜…è¯»ä¸€ä¸‹ [æ·±å…¥ React hooks  â€” 3 åˆ†é’Ÿæå®š useState](https://github.com/wuyawei/fe-code/blob/master/react/%E6%B7%B1%E5%85%A5%20React%20hooks%20%20%E2%80%94%203%20%E5%88%86%E9%92%9F%E7%90%86%E8%A7%A3%20useState.md)ã€‚

ç»§ç»­ä¸Šä¸€ç¯‡çš„ä¾‹å­ï¼Œè¿™æ¬¡æˆ‘ä»¬æ¥çœ‹çœ‹ useEffect çš„ä¸åŒä¹‹å¤„ã€‚

``` javascript
function Counter() {
    const [count, setCount] = useState(0);
    useEffect(() => {
        const id = setInterval(() => {
            setCount(count + 1);
        }, 1000);
    }, []);

    return <h1>{count}</h1>;
}
```
æˆ‘ä»¬çŸ¥é“ **æ¯æ¬¡æ›´æ–°éƒ½æ˜¯ä¸€æ¬¡é‡æ–°æ‰§è¡Œ**ã€‚æˆ‘ä»¬ç»™ useEffect çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ çš„æ˜¯ `[]`ï¼Œæ‰€ä»¥å¯ä»¥è¾¾åˆ°å›è°ƒåªè¿è¡Œä¸€æ¬¡çš„æ•ˆæœï¼ˆåªè®¾ç½®ä¸€æ¬¡å®šæ—¶å™¨ï¼‰ã€‚

ä½†æ˜¯æˆ‘ä»¬æ›´åº”è¯¥çŸ¥é“çš„æ˜¯ï¼Œå›è°ƒå‡½æ•°åªè¿è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸ä»£è¡¨ useEffect åªè¿è¡Œä¸€æ¬¡ã€‚åœ¨æ¯æ¬¡æ›´æ–°ä¸­ï¼ŒuseEffect ä¾ç„¶ä¼šæ¯æ¬¡éƒ½æ‰§è¡Œï¼Œåªä¸è¿‡å› ä¸ºä¼ é€’ç»™å®ƒçš„æ•°ç»„ä¾èµ–é¡¹æ˜¯ç©ºçš„ï¼Œå¯¼è‡´ React æ¯æ¬¡æ£€æŸ¥çš„æ—¶å€™ï¼Œéƒ½æ²¡æœ‰å‘ç°ä¾èµ–çš„å˜åŒ–ï¼Œæ‰€ä»¥ä¸ä¼šé‡æ–°æ‰§è¡Œå›è°ƒã€‚

**æ£€æŸ¥ä¾èµ–ï¼Œåªæ˜¯ç®€å•çš„æ¯”è¾ƒäº†ä¸€ä¸‹å€¼æˆ–è€…å¼•ç”¨æ˜¯å¦ç›¸ç­‰**ã€‚

è€Œä¸”ä¸Šé¢çš„å†™æ³•ï¼Œå®˜æ–¹æ˜¯ä¸æ¨èçš„ã€‚æˆ‘ä»¬åº”è¯¥ç¡®ä¿ useEffect ä¸­ç”¨åˆ°çš„çŠ¶æ€ï¼ˆå¦‚ï¼šcount ï¼‰ï¼Œéƒ½å®Œæ•´çš„æ·»åŠ åˆ°ä¾èµ–æ•°ç»„ä¸­ã€‚

**ä¸ç®¡å¼•ç”¨çš„æ˜¯åŸºç¡€ç±»å‹å€¼ã€è¿˜æ˜¯å¯¹è±¡ç”šè‡³æ˜¯å‡½æ•°**ã€‚

``` javascript
function Counter() {
    const [count, setCount] = useState(0);
    useEffect(() => {
        const id = setInterval(() => {
            setCount(count + 1);
            // ä¸æƒ³ç”¨åˆ°å¤–éƒ¨çŠ¶æ€å¯ä»¥ç”¨ setCount(count => count + 1);
        }, 1000);
    }, [count]); // ç¡®ä¿æ‰€æœ‰çŠ¶æ€ä¾èµ–éƒ½æ”¾åœ¨è¿™é‡Œ
    console.log(count);
    return <h1>{count}</h1>;
}
```

è¿™æ ·æ‰èƒ½ä¿è¯å›è°ƒä¸­å¯ä»¥æ¯æ¬¡æ‹¿åˆ°å½“å‰çš„ count å€¼ã€‚

## å‰¯ä½œç”¨
å’¦ï¼å¥½åƒæœ‰ä»€ä¹ˆå¥‡æ€ªçš„ä¸œè¥¿ã€‚

![hook.gif](https://i.loli.net/2019/09/15/NrKyJDa9MCP5FAR.gif)

å‘ç”Ÿäº†ä»€ä¹ˆä¸å¾—äº†çš„äº‹ï¼Ÿï¼Ÿï¼Ÿ

![994b6f2egy1g2b7msjhbyg207i07idi3.gif](https://i.loli.net/2019/09/15/CtbglXGMZjzTE3y.gif)

ç°åœ¨æƒ³æƒ³æˆ‘ä»¬éƒ½å¹²äº†ä»€ä¹ˆã€‚

* useEffect å›è°ƒé‡Œæ”¾äº†ä¸ªå®šæ—¶å™¨ã€‚
* ä¾èµ–æ•°ç»„æŒ‰è¦æ±‚å†™äº† countã€‚
* æ¯æ¬¡ count æ”¹å˜å¼•èµ·çš„æ›´æ–°ä¹Ÿä¼šåŒæ—¶è¿è¡Œ useEffect çš„å›è°ƒã€‚
* å›è°ƒé‡Œçš„å®šæ—¶å™¨ä¹Ÿä¼šé‡æ–°è®¾ç½®ã€‚
* å—¯ï¼Œå¥½åƒå‘ç°é—®é¢˜äº†ã€‚

æ¯æ¬¡æ›´æ–°æ—¶ï¼Œä¼šé‡æ–°è¿è¡Œ useEffect çš„å›è°ƒå‡½æ•°ï¼Œä¹Ÿå°±ä¼šé‡æ–°è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬ä¸Šä¸€æ¬¡è®¾ç½®çš„å®šæ—¶å™¨å¹¶æ²¡æœ‰æ¸…ç†æ‰ï¼Œæ‰€ä»¥é¢‘ç¹çš„æ›´æ–°ä¼šå¯¼è‡´è¶Šæ¥è¶Šå¤šçš„å®šæ—¶å™¨åŒæ—¶åœ¨è¿è¡Œã€‚
ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œå°±éœ€è¦ç”¨åˆ° useEffect çš„å¦ä¸€ä¸ªç‰¹æ€§ï¼šæ¸…é™¤å‰¯ä½œç”¨ã€‚

``` javascript
function Counter() {
    const [count, setCount] = useState(0);
    useEffect(() => {
        const id = setInterval(() => {
            setCount(count + 1);
        }, 1000);
        // è¿”å›ä¸€ä¸ªæ¸…ç†å‰¯ä½œç”¨çš„å‡½æ•°
        return () => {
            clearInterval(id);
        }
    }, [count]);
    console.log(count);
    return <h1>{count}</h1>;
}
```

okï¼Œä¸–ç•Œå®‰é™äº†ã€‚

é‚£ä¹ˆï¼Œå†æ€è€ƒä¸ªé—®é¢˜å§ã€‚useEffect æ¸…ç†å‰¯ä½œç”¨çš„æ—¶æœºæ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿåœ¨ä¸‹ä¸€æ¬¡è§†å›¾æ›´æ–°ä¹‹å‰å—ï¼Ÿ

``` javascript
function Counter() {
    const [count, setCount] = useState(0);
    useEffect(() => {
        const id = setInterval(() => {
            console.log(1, 'æˆ‘æ˜¯å®šæ—¶å™¨', count);
            setCount(count + 1);
        }, 1000);
        return () => {
            console.log(2, `æˆ‘æ¸…ç†çš„æ˜¯ ${count} çš„å‰¯ä½œç”¨`);
            clearInterval(id);
        }
    }, [count]);
    console.log(3, 'æˆ‘æ˜¯æ¸²æŸ“', count);
    return <h1>{count}</h1>;
}
```
ä¸Šé¢ä»£ç çš„æ‰“å°é¡ºåºä¼šæ˜¯ 1ã€2ã€3 å—ï¼Ÿ

![image.png](https://i.loli.net/2019/09/15/FoIC4w2qfMQGvap.png)

æ˜¾ç„¶ä¸æ˜¯ï¼ŒuseEffect åœ¨è§†å›¾æ›´æ–°ä¹‹åæ‰æ¸…ç†ä¸Šä¸€æ¬¡çš„å‰¯ä½œç”¨ã€‚è¿™ä¹ˆå¤„ç†å…¶å®ä¹Ÿæ˜¯å’Œ useEffect çš„ç‰¹æ€§ç›¸å¥‘åˆçš„ã€‚React åªä¼šåœ¨æµè§ˆå™¨ç»˜åˆ¶åè¿è¡Œ useEffectã€‚æ‰€ä»¥ Effect çš„æ¸…é™¤åŒæ ·è¢«å»¶è¿Ÿäº†ã€‚ä¸Šä¸€æ¬¡çš„ Effect ä¼šåœ¨é‡æ–°æ¸²æŸ“åè¢«æ¸…é™¤ã€‚

## ç±»ç”Ÿå‘½å‘¨æœŸ
å®˜æ–¹æ–‡æ¡£ä¸­è¯´ï¼Œå¯ä»¥å°† useEffect çš„å›è°ƒå’Œæ¸…ç†å‰¯ä½œç”¨çš„æœºåˆ¶ï¼Œç±»æ¯”æˆ class ç»„ä»¶ä¸­çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¸è¿‡ï¼Œç”±äº class ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶è‡ªèº«ç‰¹æ€§ä¸åŒçš„åŸå› ï¼Œå¯¼è‡´è¿™ç§ç±»æ¯”ä¹Ÿå®¹æ˜“ä½¿äººè¿·æƒ‘ã€‚

> å¦‚æœä½ ç†Ÿæ‚‰ React class çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œä½ å¯ä»¥æŠŠ useEffect Hook çœ‹åš componentDidMountï¼ŒcomponentDidUpdate å’Œ componentWillUnmount è¿™ä¸‰ä¸ªå‡½æ•°çš„ç»„åˆã€‚ --[ä½¿ç”¨ Effect Hook](https://react-1251415695.cos-website.ap-chengdu.myqcloud.com/docs/hooks-effect.html)

æˆ‘ä»¬ç»å¸¸æƒ³æŠŠç¬¬äºŒä¸ªå‚æ•°è®¾ç½®æˆ`[]`ï¼Œæ¥è¾¾åˆ°å’Œ componentDidMount ä¸€æ ·çš„æ•ˆæœã€‚ä½†æ˜¯å¾€å¾€ä¹Ÿæœ€å®¹æ˜“å‡ºé—®é¢˜ï¼Œå°±åƒæˆ‘ä»¬ä¸€å¼€å§‹çš„å®šæ—¶å™¨ä¾‹å­ä¸€æ ·ã€‚
