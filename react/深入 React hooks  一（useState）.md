## å‰è¨€
React Hooksçš„åŸºæœ¬ç”¨æ³•ï¼Œ[å®˜æ–¹æ–‡æ¡£](https://react.docschina.org/docs/hooks-intro.html) å·²ç»éå¸¸è¯¦ç»†ã€‚æœ¬æ–‡çš„ç›®çš„ï¼Œæ˜¯æƒ³é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­è¯¦ç»†åˆ†æä¸€äº›ä»¤äººç–‘æƒ‘çš„é—®é¢˜åŠå…¶èƒŒåçš„åŸå› ã€‚è¿™æ˜¯ç³»åˆ—çš„ç¬¬ä¸€ç¯‡ï¼Œä¸»è¦è®²è§£ useStateã€‚

**ä¸ªäººåšå®¢åœ°å€ [ğŸ¹ğŸ° fe-code](https://github.com/wuyawei/fe-code)**

## ç–‘æƒ‘
> ä¸€èµ·æ¥çœ‹çœ‹è¿™ä¸ªæ —å­ã€‚

``` javascript
function Counter() {
    const [count, setCount] = useState(0);
    useEffect(() => {
        const id = setInterval(() => {
            // console.log(count);
            setCount(count + 1);
        }, 1000);
    }, []);

    return <h1>{count}</h1>;
}
```
æˆ‘ä»¬æœŸæœ›ï¼ŒuseEffect åªæ‰§è¡Œä¸€æ¬¡ï¼Œä¸”åç»­æ¯éš” 1sï¼Œcount è‡ªåŠ¨ + 1ã€‚ç„¶è€Œï¼Œ å®é™…ä¸Š count ä» 0 åˆ° 1 åï¼Œå†æ²¡æœ‰å˜åŒ–ï¼Œä¸€ç›´éƒ½æ˜¯ 1ã€‚éš¾é“æ˜¯ setInterval æ²¡æ‰§è¡Œï¼Ÿäºæ˜¯æˆ‘ä»¬å¾ˆç–‘æƒ‘çš„åŠ ä¸Šäº†æ‰“å°ã€‚

![image.png](https://i.loli.net/2019/09/10/loHQOmKT9G7buM4.png)

äº‹å®æ˜¯ï¼ŒsetInterval æ¯æ¬¡æ‰§è¡Œçš„æ—¶å€™ï¼Œæ‹¿åˆ°çš„ count éƒ½æ˜¯ 0ã€‚å¾ˆè‡ªç„¶çš„æˆ‘ä»¬ä¼šæƒ³åˆ°é—­åŒ…ï¼Œä½†æ˜¯é—­åŒ…èƒ½å®Œå…¨è§£é‡Šè¿™ä¸ªç°è±¡å—ã€‚æˆ‘ä»¬ç¨åŠ ä¿®æ”¹å†çœ‹ä¸‹è¿™ä¸ªä¾‹å­ã€‚

``` javascript
function Counter() {
    const [count, setCount] = useState(0);
    let num = 0;
    useEffect(() => {
        const id = setInterval(() => {
            console.log(num);
            setCount(++num);
        }, 1000);
    }, []);

    return <h1>{count}</h1>;
}
```

![image.png](https://i.loli.net/2019/09/10/7poFOdhnBiKtwTZ.png)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå€ŸåŠ© num è¿™ä¸ªä¸­é—´å˜é‡ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°æƒ³è¦çš„ç»“æœã€‚ä½†æ˜¯ï¼ŒåŒæ ·æ˜¯é—­åŒ…ï¼Œä¸ºä»€ä¹ˆ num å°±èƒ½è®°ä½ä¹‹å‰çš„å€¼å‘¢ï¼Ÿå…¶å®é—®é¢˜å‡ºåœ¨ count ä¸Šï¼Œç»§ç»­å¾€ä¸‹çœ‹ï¼š

``` javascript
function Counter() {
    // ...
    console.log('æˆ‘æ˜¯ num', num);

    return <h1>{count}-----{num}</h1>;
}
```

![image.png](https://i.loli.net/2019/09/10/mYOcVkM1ASXED8a.png)

æ¸²æŸ“çš„ num å’Œå®šæ—¶å™¨ä¸­çš„ num ä¸ºä»€ä¹ˆä¼šä¸ä¸€æ ·å‘¢ï¼Ÿ

## æ¯æ¬¡éƒ½æ˜¯é‡æ–°æ‰§è¡Œ

åˆ°è¿™é‡Œæˆ‘æƒ³è¯´çš„åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æ¸…æ™°çœ‹è§æ¸²æŸ“å‡ºçš„ num å’Œ setInterval ä¸­çš„ numï¼Œæ˜¯ä¸åŒçš„ã€‚è¿™æ˜¯å› ä¸ºå¯¹äºå‡½æ•°å¼ç»„ä»¶æ¥è®²ï¼Œæ¯æ¬¡æ›´æ–°éƒ½ä¼šé‡æ–°æ‰§è¡Œä¸€éæ¸²æŸ“å‡½æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯æ¬¡æ›´æ–°éƒ½ä¼šåœ¨å½“å‰ä½œç”¨åŸŸé‡æ–°å£°æ˜ä¸€ä¸ª `let num = 0`ï¼Œæ‰€ä»¥ï¼Œå®šæ—¶å™¨ä¸­é—­åŒ…å¼•ç”¨çš„é‚£ä¸ª numï¼Œå’Œæ¯æ¬¡æ›´æ–°æ—¶æ¸²æŸ“çš„ numï¼Œæ ¹æœ¬ä¸æ˜¯åŒä¸€ä¸ªã€‚å½“ç„¶ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆè½»æ˜“çš„æŠŠå®ƒä»¬å˜æˆåŒä¸€ä¸ªã€‚

``` javascript
let num = 0; // å°†å£°æ˜æ”¾åˆ°æ¸²æŸ“ç»„ä»¶å¤–é¢
function Counter() {
    // ...
    return <h1>{count}-----{num}</h1>;
}
```

å—¯ï¼Œè¯´äº†è¿™ä¹ˆå¤šï¼Œè·Ÿ count æœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼ŸåŒç†ï¼Œæ­£å› ä¸ºå‡½æ•°ç»„ä»¶æ¯æ¬¡éƒ½ä¼šæ•´ä½“é‡æ–°æ‰§è¡Œï¼Œé‚£ä¹ˆ Hooks å½“ç„¶ä¹Ÿæ˜¯è¿™æ ·ã€‚

``` javascript
function Counter() {
    const [count, setCount] = useState(0);
    // ...
}
```
**useState åº”è¯¥ç†è§£ä¸ºå’Œæ™®é€šçš„ javascript å‡½æ•°ä¸€æ ·ï¼Œè€Œä¸æ˜¯ React çš„ä»€ä¹ˆé»‘é­”æ³•**ã€‚å‡½æ•°ç»„ä»¶æ›´æ–°çš„æ—¶å€™ï¼ŒuseState ä¼šé‡æ–°æ‰§è¡Œï¼Œå¯¹åº”çš„ï¼Œä¹Ÿä¼šé‡æ–°å£°æ˜ `[count, setCount]` è¿™ä¸€ç»„å¸¸é‡ã€‚åªä¸è¿‡ React å¯¹è¿™ä¸ªå‡½æ•°åšäº†ä¸€äº›ç‰¹æ®Šå¤„ç†ã€‚æ¯”å¦‚ï¼šé¦–æ¬¡æ‰§è¡Œæ—¶ï¼Œä¼šå°† useState çš„å‚æ•°åˆå§‹åŒ–ç»™ countï¼Œè€Œä»¥åå†æ¬¡æ‰§è¡Œæ—¶ï¼Œåˆ™ä¼šç›´æ¥å–ä¸Šæ¬¡ setCount (å¦‚æœæœ‰è°ƒç”¨) èµ‹è¿‡çš„å€¼ï¼ˆReact é€šè¿‡æŸç§æ–¹å¼ä¿å­˜èµ·æ¥çš„ï¼‰ã€‚

æœ‰äº†è¿™ä¸ªæ¦‚å¿µï¼Œå°±ä¸éš¾çŸ¥é“ï¼Œå®šæ—¶å™¨é‡Œçš„`setCount(count + 1)` ï¼Œè¿™ä¸ª count å’Œæ¯æ¬¡æ›´æ–°é‡æ–°å£°æ˜çš„ countï¼Œä¹Ÿæ˜¯å®Œå…¨ä¸åŒçš„ä¸¤ä¸ªå¸¸é‡ï¼Œåªä¸è¿‡å®ƒä»¬çš„å€¼ï¼Œå¯èƒ½ä¼šç›¸ç­‰ã€‚

æˆ‘ä»¬å°è¯•æŠŠä¹‹å‰çš„ numï¼Œç›´æ¥ç”¨ count æ›¿ä»£ã€‚

``` javascript
function Counter() {
    // æ³¨æ„è¿™é‡Œå˜æˆ let
    let [count, setCount] = useState(0);
    useEffect(() => {
        const id = setInterval(() => {
            // è¿™ç§å†™æ³•æ˜¯ä¸å¥½çš„
            setCount(++count);
        }, 1000);
    }, []);
    console.log(count);
    return <h1>{count}</h1>;
}
```

è¿™æ—¶å€™ä¸è®ºæ˜¯æ‰“å°è¿˜æ˜¯é¡µé¢è¡¨ç°éƒ½å’Œä½ æœŸæœ›çš„ä¸€æ ·ï¼Œ**ä½†æ˜¯è¿™è¿èƒŒäº† React çš„åŸåˆ™ï¼Œè€Œä¸”ä¹Ÿè®©ç¨‹åºå˜å¾—æ›´è®©äººè¿·æƒ‘**ã€‚ä¹Ÿå°±å¯¼è‡´ä½ å¹¶ä¸èƒ½æ¸…æ¥šåœ°çŸ¥é“ï¼šæ­¤æ—¶æ¸²æŸ“çš„ count å’Œ setInterval ä¸­çš„ count å·²ç»ä¸æ˜¯åŒä¸€ä¸ªäº†ã€‚å°½ç®¡ä»–ä»¬çš„å€¼æ˜¯ç›¸ç­‰çš„ã€‚

å½“ç„¶ï¼Œè¿™ç§åœºæ™¯ä¸‹ React ä¹Ÿæä¾›äº†å¯è¡Œçš„æ–¹æ³•ï¼Œèƒ½å¤Ÿæ¯æ¬¡æ‹¿åˆ° count çš„æœ€æ–°å€¼ï¼Œå°±æ˜¯ç»™ setCount ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ã€‚

``` javascript
function Counter() {
    const [count, setCount] = useState(0);
    useEffect(() => {
        const id = setInterval(() => {
            // æ³¨æ„ï¼šè¿™é‡Œå˜æˆå›è°ƒäº†
            setCount(count => count + 1);
        }, 1000);
    }, []);

    return <h1>{count}</h1>;
}
```

## æ‰§è¡Œå›¾è§£
å›è¿‡å¤´å†çœ‹çœ‹å¼€å§‹çš„ä¾‹å­ï¼š

``` javascript
function Counter() {
    const [count, setCount] = useState(0);
    useEffect(() => {
        const id = setInterval(() => {
            setCount(count + 1);
        }, 1000);
    }, []);

    return <h1>{count}</h1>;
}
```

![image.png](https://i.loli.net/2019/09/10/zXIGwB2Mr7f85Pp.png)

## å°ç»“
count æ¯æ¬¡éƒ½è¢«é‡æ–°å£°æ˜äº†ï¼ŒsetInterval å› ä¸º useEffect è®¾ç½®äº†åªæ‰§è¡Œä¸€æ¬¡çš„ç¼˜æ•…ï¼Œåœ¨ç¬¬ä¸€æ¬¡æ›´æ–°æ—¶é—­åŒ…å¼•ç”¨çš„ count å§‹ç»ˆæ˜¯ 0ï¼Œåç»­æ›´æ–°çš„ count å’Œå®ƒæ²¡å…³ç³»ã€‚