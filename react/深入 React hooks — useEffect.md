## å‰è¨€
React Hooksçš„åŸºæœ¬ç”¨æ³•ï¼Œ[å®˜æ–¹æ–‡æ¡£](https://react.docschina.org/docs/hooks-intro.html) å·²ç»éå¸¸è¯¦ç»†ã€‚æœ¬æ–‡çš„ç›®çš„ï¼Œæ˜¯æƒ³é€šè¿‡ä¸€ä¸ªç®€å•çš„ä¾‹å­è¯¦ç»†åˆ†æä¸€äº›ä»¤äººç–‘æƒ‘çš„é—®é¢˜åŠå…¶èƒŒåçš„åŸå› ã€‚è¿™æ˜¯ç³»åˆ—çš„ç¬¬äºŒç¯‡ï¼Œä¸»è¦è®²è§£ useEffectã€‚

**ä¸ªäººåšå®¢åœ°å€ [ğŸ¹ğŸ° fe-code](https://github.com/wuyawei/fe-code)**


## ç±»ç”Ÿå‘½å‘¨æœŸ
å®˜æ–¹æ–‡æ¡£ä¸­è¯´ï¼Œå¯ä»¥å°† useEffect çš„å›è°ƒå’Œæ¸…ç†å‰¯ä½œç”¨çš„æœºåˆ¶ï¼Œç±»æ¯”æˆ class ç»„ä»¶ä¸­çš„ç”Ÿå‘½å‘¨æœŸã€‚ä¸è¿‡ï¼Œç”±äº class ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶è‡ªèº«ç‰¹æ€§ä¸åŒçš„åŸå› ï¼Œå¯¼è‡´è¿™ç§ç±»æ¯”ä¹Ÿå®¹æ˜“ä½¿äººè¿·æƒ‘ã€‚

> å¦‚æœä½ ç†Ÿæ‚‰ React class çš„ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼Œä½ å¯ä»¥æŠŠ useEffect Hook çœ‹åš componentDidMountï¼ŒcomponentDidUpdate å’Œ componentWillUnmount è¿™ä¸‰ä¸ªå‡½æ•°çš„ç»„åˆã€‚ --[ä½¿ç”¨ Effect Hook](https://react-1251415695.cos-website.ap-chengdu.myqcloud.com/docs/hooks-effect.html)

ä¸è¿‡æœ‰æ—¶ä¹Ÿå®¹æ˜“å‡ºé—®é¢˜ï¼Œå°±åƒæˆ‘ä»¬ä¸€å¼€å§‹çš„å®šæ—¶å™¨ä¾‹å­ä¸€æ ·ã€‚

``` javascript
function Counter() {
    const [count, setCount] = useState(0);
    useEffect(() => {
        const id = setInterval(() => {
            setCount(count + 1);
        }, 1000);
    }, []);

    return <h1>{count}</h1>;
}
```

æˆ‘ä»¬çš„éœ€æ±‚å¾ˆæ˜ç¡®ï¼Œå°±æ˜¯åœ¨ componentDidMount çš„æ—¶å€™ï¼Œè®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ã€‚å¹¶ä¸”ä¿è¯ä¸ä¼šæ¯æ¬¡æ›´æ–°ï¼ˆcomponentDidUpdateï¼‰éƒ½é‡æ–°è®¾ç½®ã€‚æ‰€ä»¥æˆ‘ä»¬æŠŠç¬¬äºŒä¸ªå‚æ•°è®¾ç½®æˆ`[]`ï¼Œæ¥è¾¾åˆ°ä¸€æ ·çš„æ•ˆæœã€‚

å½“ç„¶è¿™æ˜¯æœ‰é—®é¢˜çš„ï¼Œç”±äºå‡½æ•°å¼ç»„ä»¶æ‰§è¡Œæ–¹å¼çš„ä¸åŒï¼Œæˆ‘ä»¬åœ¨ useEffect ä¸­æ‹¿åˆ°çš„ count æ˜¯é—­åŒ…å¼•ç”¨çš„ï¼Œè€Œæ¯æ¬¡æ›´æ–°åˆä¼šæ˜¯ä¸€ä¸ªå…¨æ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚è¿™åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­å·²ç»è¯¦ç»†åˆ†æè¿‡ã€‚ä½†æ˜¯åœ¨ class ç»„ä»¶ä¸­ï¼Œç”Ÿå‘½å‘¨æœŸä¸­çš„å¼•ç”¨æ˜¯è¿™æ ·çš„ `this.state.count`ï¼Œè€Œä¸”ä¸åŒäºå‡½æ•°å¼ï¼Œè¿™ç§æ–¹å¼æ¯æ¬¡æ‹¿åˆ°çš„ count éƒ½æ˜¯æœ€æ–°çš„ã€‚

React Hooks ä¹Ÿæä¾›äº†ä¸€ä¸ªç±»ä¼¼ä½œç”¨çš„ hook æ¥å¸®æˆ‘ä»¬ä¿å­˜ä¸€äº›å€¼ â€” [useRef](https://react-1251415695.cos-website.ap-chengdu.myqcloud.com/docs/hooks-reference.html#useref)ï¼Œ`å®ƒå¯ä»¥å¾ˆæ–¹ä¾¿åœ°ä¿å­˜ä»»ä½•å¯å˜å€¼ï¼Œå…¶ç±»ä¼¼äºåœ¨ class ä¸­ä½¿ç”¨å®ä¾‹å­—æ®µçš„æ–¹å¼`ã€‚ä¸è¿‡è¿™é‡Œä¸å¤ªé€‚ç”¨ã€‚

æ€»çš„æ¥è¯´ï¼ŒuseEffect å’ŒçœŸæ­£çš„ç”Ÿå‘½å‘¨æœŸè¿˜æ˜¯æœ‰äº›åŒºåˆ«çš„ï¼Œåœ¨ä½¿ç”¨çš„æ—¶å€™éœ€è¦å¤šåŠ æ³¨æ„ã€‚

## ä¾èµ–
> é€šè¿‡ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†ä¸€äº›å¾ˆé‡è¦çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼šæ¯æ¬¡æ›´æ–°éƒ½æ˜¯ä¸€æ¬¡é‡æ–°æ‰§è¡Œã€‚è¿™ä¸ä»…ä»…æ˜¯å¯¹äº useState æ¥è¯´çš„ï¼Œæ•´ä¸ªå‡½æ•°ç»„ä»¶éƒ½æ˜¯è¿™æ ·ã€‚ä¸å¤ªäº†è§£çš„åŒå­¦ï¼Œå¯ä»¥å…ˆé˜…è¯»ä¸€ä¸‹ [æ·±å…¥ React hooks  â€”  useState](https://github.com/wuyawei/fe-code/blob/master/react/%E6%B7%B1%E5%85%A5%20React%20hooks%20%20%E2%80%94%203%20%E5%88%86%E9%92%9F%E7%90%86%E8%A7%A3%20useState.md)ã€‚

``` javascript
function Counter() {
    const [count, setCount] = useState(0);
    useEffect(() => {
        const id = setInterval(() => {
            setCount(count + 1);
        }, 1000);
    }, []);

    return <h1>{count}</h1>;
}
```
æˆ‘ä»¬çŸ¥é“ **æ¯æ¬¡æ›´æ–°éƒ½æ˜¯ä¸€æ¬¡é‡æ–°æ‰§è¡Œ**ã€‚æˆ‘ä»¬ç»™ useEffect çš„ç¬¬äºŒä¸ªå‚æ•°ä¼ çš„æ˜¯ `[]`ï¼Œæ‰€ä»¥å¯ä»¥è¾¾åˆ°å›è°ƒåªè¿è¡Œä¸€æ¬¡çš„æ•ˆæœï¼ˆåªè®¾ç½®ä¸€æ¬¡å®šæ—¶å™¨ï¼‰ã€‚

ä½†æ˜¯æˆ‘ä»¬æ›´åº”è¯¥çŸ¥é“çš„æ˜¯ï¼Œå›è°ƒå‡½æ•°åªè¿è¡Œä¸€æ¬¡ï¼Œå¹¶ä¸ä»£è¡¨ useEffect åªè¿è¡Œä¸€æ¬¡ã€‚åœ¨æ¯æ¬¡æ›´æ–°ä¸­ï¼ŒuseEffect ä¾ç„¶ä¼šæ¯æ¬¡éƒ½æ‰§è¡Œï¼Œåªä¸è¿‡å› ä¸ºä¼ é€’ç»™å®ƒçš„æ•°ç»„ä¾èµ–é¡¹æ˜¯ç©ºçš„ï¼Œå¯¼è‡´ React æ¯æ¬¡æ£€æŸ¥çš„æ—¶å€™ï¼Œéƒ½æ²¡æœ‰å‘ç°ä¾èµ–çš„å˜åŒ–ï¼Œæ‰€ä»¥ä¸ä¼šé‡æ–°æ‰§è¡Œå›è°ƒã€‚

**æ£€æŸ¥ä¾èµ–ï¼Œåªæ˜¯ç®€å•çš„æ¯”è¾ƒäº†ä¸€ä¸‹å€¼æˆ–è€…å¼•ç”¨æ˜¯å¦ç›¸ç­‰**ã€‚

è€Œä¸”ä¸Šé¢çš„å†™æ³•ï¼Œå®˜æ–¹æ˜¯ä¸æ¨èçš„ã€‚æˆ‘ä»¬åº”è¯¥ç¡®ä¿ useEffect ä¸­ç”¨åˆ°çš„çŠ¶æ€ï¼ˆå¦‚ï¼šcount ï¼‰ï¼Œéƒ½å®Œæ•´çš„æ·»åŠ åˆ°ä¾èµ–æ•°ç»„ä¸­ã€‚ **ä¸ç®¡å¼•ç”¨çš„æ˜¯åŸºç¡€ç±»å‹å€¼ã€è¿˜æ˜¯å¯¹è±¡ç”šè‡³æ˜¯å‡½æ•°**ã€‚

``` javascript
function Counter() {
    const [count, setCount] = useState(0);
    useEffect(() => {
        const id = setInterval(() => {
            setCount(count + 1);
            // ä¸æƒ³ç”¨åˆ°å¤–éƒ¨çŠ¶æ€å¯ä»¥ç”¨ setCount(count => count + 1);
        }, 1000);
    }, [count]); // ç¡®ä¿æ‰€æœ‰çŠ¶æ€ä¾èµ–éƒ½æ”¾åœ¨è¿™é‡Œ
    console.log(count);
    return <h1>{count}</h1>;
}
```

è¿™æ ·æ‰èƒ½ä¿è¯å›è°ƒä¸­å¯ä»¥æ¯æ¬¡æ‹¿åˆ°å½“å‰çš„ count å€¼ã€‚

## å‰¯ä½œç”¨
å’¦ï¼å¥½åƒæœ‰ä»€ä¹ˆå¥‡æ€ªçš„ä¸œè¥¿ã€‚

![hook.gif](https://user-gold-cdn.xitu.io/2019/10/4/16d95f548c398e25?w=529&h=448&f=gif&s=39359)

å‘ç”Ÿäº†ä»€ä¹ˆä¸å¾—äº†çš„äº‹ï¼Ÿï¼Ÿï¼Ÿ

![994b6f2egy1g2b7msjhbyg207i07idi3.gif](https://user-gold-cdn.xitu.io/2019/10/4/16d95f548c543645?w=270&h=270&f=gif&s=93561)

ç°åœ¨æƒ³æƒ³æˆ‘ä»¬éƒ½å¹²äº†ä»€ä¹ˆã€‚

* useEffect å›è°ƒé‡Œæ”¾äº†ä¸ªå®šæ—¶å™¨ã€‚
* ä¾èµ–æ•°ç»„æŒ‰è¦æ±‚å†™äº† countã€‚
* æ¯æ¬¡ count æ”¹å˜å¼•èµ·çš„æ›´æ–°ä¹Ÿä¼šåŒæ—¶è¿è¡Œ useEffect çš„å›è°ƒã€‚
* å›è°ƒé‡Œçš„å®šæ—¶å™¨ä¹Ÿä¼šé‡æ–°è®¾ç½®ã€‚
* å—¯ï¼Œå¥½åƒå‘ç°é—®é¢˜äº†ã€‚

æ¯æ¬¡æ›´æ–°æ—¶ï¼Œä¼šé‡æ–°è¿è¡Œ useEffect çš„å›è°ƒå‡½æ•°ï¼Œä¹Ÿå°±ä¼šé‡æ–°è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ã€‚ä½†æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬ä¸Šä¸€æ¬¡è®¾ç½®çš„å®šæ—¶å™¨å¹¶æ²¡æœ‰æ¸…ç†æ‰ï¼Œæ‰€ä»¥é¢‘ç¹çš„æ›´æ–°ä¼šå¯¼è‡´è¶Šæ¥è¶Šå¤šçš„å®šæ—¶å™¨åŒæ—¶åœ¨è¿è¡Œã€‚
ä¸ºäº†è§£å†³ä¸Šé¢çš„é—®é¢˜ï¼Œå°±éœ€è¦ç”¨åˆ° useEffect çš„å¦ä¸€ä¸ªç‰¹æ€§ï¼šæ¸…é™¤å‰¯ä½œç”¨ã€‚

``` javascript
function Counter() {
    const [count, setCount] = useState(0);
    useEffect(() => {
        const id = setInterval(() => {
            setCount(count + 1);
        }, 1000);
        // è¿”å›ä¸€ä¸ªæ¸…ç†å‰¯ä½œç”¨çš„å‡½æ•°
        return () => {
            clearInterval(id);
        }
    }, [count]);
    console.log(count);
    return <h1>{count}</h1>;
}
```

okï¼Œä¸–ç•Œå®‰é™äº†ã€‚

é‚£ä¹ˆï¼Œå†æ€è€ƒä¸ªé—®é¢˜å§ã€‚useEffect æ¸…ç†å‰¯ä½œç”¨çš„æ—¶æœºæ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿåœ¨ä¸‹ä¸€æ¬¡è§†å›¾æ›´æ–°ä¹‹å‰å—ï¼Ÿ

``` javascript
function Counter() {
    const [count, setCount] = useState(0);
    useEffect(() => {
        const id = setInterval(() => {
            console.log(1, 'æˆ‘æ˜¯å®šæ—¶å™¨', count);
            setCount(count + 1);
        }, 1000);
        return () => {
            console.log(2, `æˆ‘æ¸…ç†çš„æ˜¯ ${count} çš„å‰¯ä½œç”¨`);
            clearInterval(id);
        }
    }, [count]);
    console.log(3, 'æˆ‘æ˜¯æ¸²æŸ“', count);
    return <h1>{count}</h1>;
}
```
ä¸Šé¢ä»£ç çš„æ‰“å°é¡ºåºä¼šæ˜¯ 1ã€2ã€3 å—ï¼Ÿ

![image.png](https://user-gold-cdn.xitu.io/2019/10/4/16d95f553cf424b7?w=328&h=264&f=png&s=32877)

æ˜¾ç„¶ä¸æ˜¯ï¼ŒuseEffect åœ¨è§†å›¾æ›´æ–°ä¹‹åæ‰æ¸…ç†ä¸Šä¸€æ¬¡çš„å‰¯ä½œç”¨ã€‚è¿™ä¹ˆå¤„ç†å…¶å®ä¹Ÿæ˜¯å’Œ useEffect çš„ç‰¹æ€§ç›¸å¥‘åˆçš„ã€‚React åªä¼šåœ¨æµè§ˆå™¨ç»˜åˆ¶åè¿è¡Œ useEffectã€‚æ‰€ä»¥ Effect çš„æ¸…é™¤åŒæ ·è¢«å»¶è¿Ÿäº†ã€‚ä¸Šä¸€æ¬¡çš„ Effect ä¼šåœ¨é‡æ–°æ¸²æŸ“åè¢«æ¸…é™¤ã€‚

## å°ç»“
ä½¿ç”¨ useEffect æ—¶ï¼Œéœ€è¦æ³¨æ„çŠ¶æ€çš„å¼•ç”¨ï¼Œä¾èµ–çš„æ·»åŠ ä»¥åŠå‰¯ä½œç”¨çš„æ¸…é™¤ï¼ˆæ²¡æœ‰å°±ä¸ç”¨äº†ï¼‰ã€‚å¾ˆå¤šæ—¶å€™è¿˜éœ€è¦å€ŸåŠ©å…¶ä»–çš„ hook æ‰èƒ½å®Œæˆè¿™ä¸ªå·¥ä½œï¼Œæ¯”å¦‚ useRef/useCallbackç­‰ã€‚

## å‚è€ƒæ–‡ç« 
* [useEffect å®Œæ•´æŒ‡å—](https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/)
* [ä½¿ç”¨ Effect Hook](https://react-1251415695.cos-website.ap-chengdu.myqcloud.com/docs/hooks-effect.html)

## äº¤æµç¾¤

>å¾®ä¿¡ç¾¤ï¼šæ‰«ç å›å¤åŠ ç¾¤ã€‚

![mmqrcode1566432627920.png](https://user-gold-cdn.xitu.io/2019/9/15/16d3303fb5ae517d?w=200&h=200&f=jpeg&s=25608)

## åè®°
  å¦‚æœä½ çœ‹åˆ°äº†è¿™é‡Œï¼Œä¸”æœ¬æ–‡å¯¹ä½ æœ‰ä¸€ç‚¹å¸®åŠ©çš„è¯ï¼Œå¸Œæœ›ä½ å¯ä»¥åŠ¨åŠ¨å°æ‰‹æ”¯æŒä¸€ä¸‹ä½œè€…ï¼Œæ„Ÿè°¢ğŸ»ã€‚æ–‡ä¸­å¦‚æœ‰ä¸å¯¹ä¹‹å¤„ï¼Œä¹Ÿæ¬¢è¿å¤§å®¶æŒ‡å‡ºï¼Œå…±å‹‰ã€‚å¥½äº†ï¼Œåˆè€½è¯¯å¤§å®¶çš„æ—¶é—´äº†ï¼Œæ„Ÿè°¢é˜…è¯»ï¼Œä¸‹æ¬¡å†è§ï¼

* **æ–‡ç« ä»“åº“** [ğŸ¹ğŸ°fe-code](https://github.com/wuyawei/fe-code)

æ„Ÿå…´è¶£çš„åŒå­¦å¯ä»¥å…³æ³¨ä¸‹æˆ‘çš„å…¬ä¼—å· **å‰ç«¯å‘åŠ¨æœº**ï¼Œå¥½ç©åˆæœ‰æ–™ã€‚

![](https://user-gold-cdn.xitu.io/2019/7/21/16c14d1d0f3be11e?w=400&h=400&f=jpeg&s=34646)
